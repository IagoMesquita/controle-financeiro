import type { NextPage } from "next";
import { useState, useEffect } from "react";
import Head from "next/head";
// components
import Form from "../components/Form";
import Resume from "../components/Resume";
import { ITransaction } from "../interface/ITransaction";



const Home: NextPage = () => {
  const data = typeof window !== 'undefined' && localStorage.getItem('register'); 

  const [transactions, setTransaction] = useState<ITransaction[]>(
    data ? JSON.parse(data) : []
  );

  const [entries, setEntries] = useState<number>(0);
  const [expenses, setExpenses] = useState<number>(0);
  const [balance, setBalance] = useState<number>(0);
  

  useEffect(() => {

    const sumOfEntries = transactions.filter((el) => el.isExpense === false)
      .reduce((acc, el) => acc + Number(el.amount),0)

    const sumOfExpenses = transactions.filter((el) => el.isExpense)
      .reduce((acc, el) => acc + Number(el.amount),0)

    const total = sumOfEntries - sumOfExpenses;

    setEntries(sumOfEntries);
    setExpenses(sumOfExpenses);
    setBalance(total);

   
  }, [transactions])

  const handleAdd = (transaction: ITransaction) => {
    const newTransactions = [...transactions, transaction];
    
    setTransaction(newTransactions);

    localStorage.setItem('transactions', JSON.stringify(newTransactions));

  }

  return (
    <div>
      <Head>
        <title>Controle Financeiro</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Resume 
        entries={entries}
        expenses={expenses}
        balance={balance}
      />
      <Form 
        handleAdd={handleAdd}
        transactions={transactions}
        setTransaction={setTransaction}
      />
    </div>
  );
};

export default Home;
